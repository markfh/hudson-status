#!/usr/bin/env ruby
require 'open-uri'
require 'nokogiri'

# download xml
url = "#{ARGV[0]}/api/xml"
xml = `curl '#{url}' --silent`.strip
begin
  document = Nokogiri.parse(xml)
rescue
  puts "Invalid XML from #{url}"
  exit 1
end

# print project state
document.css('hudson > job').each do |job|
  color_codes = {
    'red' => 'Failed',
    'blue' => 'Success',
    'blue_anime' => 'Pending',
    'red_anime' => 'Pending'
  }
  name = job.css('name').first.content
  color = job.css('color').first.content
  color = (color_codes[color] || "Unknown #{color}")
  puts "#{name}: #{color}"
end
